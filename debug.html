<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>对话功能调试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>副业推荐器对话功能调试</h1>
    
    <div class="test-section">
        <h3>1. API连接测试</h3>
        <button onclick="testAPIConnection()">测试API连接</button>
        <div id="api-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. 欢迎消息生成测试</h3>
        <button onclick="testWelcomeMessage()">测试欢迎消息</button>
        <div id="welcome-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. 问题生成测试</h3>
        <button onclick="testQuestionGeneration()">测试问题生成</button>
        <div id="question-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>4. 对话回复测试</h3>
        <button onclick="testContextualResponse()">测试对话回复</button>
        <div id="response-result" class="result"></div>
    </div>

    <script>
        async function testAPIConnection() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '测试中...';
            
            try {
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer sk-29c306bada2f48b8bb34ef53d97081aa',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [{
                            role: 'user',
                            content: '你好，这是一个测试消息。请回复"测试成功"。'
                        }],
                        max_tokens: 50
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `✅ API连接成功！<br>回复: ${data.choices[0].message.content}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `❌ API连接失败: ${error.message}`;
            }
        }
        
        async function testWelcomeMessage() {
            const resultDiv = document.getElementById('welcome-result');
            resultDiv.innerHTML = '测试中...';
            
            try {
                const prompt = `你是一个亲切的副业推荐助手，用户刚选择了身份标签「早八特困生」。请生成一个有趣、个性化的欢迎消息（20-40字），要求：
1. 体现对这个身份的理解和共鸣
2. 语气轻松友好，像朋友聊天
3. 表达要开始了解用户具体情况
4. 可以适当使用emoji
5. 避免过于正式或商业化的表达

只返回欢迎消息内容，不要其他解释。`;
                
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer sk-29c306bada2f48b8bb34ef53d97081aa',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        temperature: 0.8,
                        max_tokens: 100
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `✅ 欢迎消息生成成功！<br>消息: ${data.choices[0].message.content}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `❌ 欢迎消息生成失败: ${error.message}`;
            }
        }
        
        async function testQuestionGeneration() {
            const resultDiv = document.getElementById('question-result');
            resultDiv.innerHTML = '测试中...';
            
            try {
                const prompt = `你是一个亲切的副业推荐助手，需要生成一个收集用户信息的问题。

问题类型：询问用户的学校信息（包括在读或毕业院校）

要求：
1. 语气轻松友好，像朋友聊天
2. 问题简洁明了（15-30字）
3. 可以给出1-2个具体例子帮助用户理解
4. 适当使用emoji让对话更生动
5. 避免过于正式或商业化的表达

只返回问题内容，不要其他解释。`;
                
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer sk-29c306bada2f48b8bb34ef53d97081aa',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        temperature: 0.7,
                        max_tokens: 80
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `✅ 问题生成成功！<br>问题: ${data.choices[0].message.content}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `❌ 问题生成失败: ${error.message}`;
            }
        }
        
        async function testContextualResponse() {
            const resultDiv = document.getElementById('response-result');
            resultDiv.innerHTML = '测试中...';
            
            try {
                const prompt = `你是一个亲切的聊天助手，正在与用户进行轻松的对话收集信息。

对话上下文：
学校：清华大学

当前问题类型：专业信息
用户刚才的回答："计算机科学与技术"
回复风格：理解共鸣型
建议语气词：哇

请根据用户的具体回答和已有信息生成一个个性化、有趣的回复（15-30字），要求：
1. 基于用户已提供的信息（学校、专业、身份等）进行个性化回复
2. 每次回复都要有所不同，避免重复套路
3. 根据指定的回复风格调整语气，要生动有趣
4. 可以适当调侃、共鸣或鼓励，让对话更有趣
5. 避免提及具体的副业类型或方向
6. 语气轻松友好，像朋友聊天一样，要有个性
7. 可以结合用户的背景信息进行有趣的联想和评论

只返回回复内容，不要其他解释。`;
                
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer sk-29c306bada2f48b8bb34ef53d97081aa',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        temperature: 0.9,
                        max_tokens: 50
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `✅ 对话回复生成成功！<br>回复: ${data.choices[0].message.content}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `❌ 对话回复生成失败: ${error.message}`;
            }
        }
    </script>
</body>
</html>